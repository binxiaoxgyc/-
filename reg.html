<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./css/comm.css">
    <link rel="stylesheet" href="./css/reg.css">
</head>
<body>
    <header>
        <div class="header_top">
            <ul class="box">
                <li>
                    <img src="./img/collect.jpg" alt=""><a href="#">收藏</a>
                    <a href="#"><img src="./img/weixin1.jpg" alt="">微信</a>
                </li>
                <li>
                    <a href="login.html" traget="_blank">登录</a>
                    <span>|</span>
                    <a href="reg.html" traget="_blank">注册</a>
                </li>
            </ul>
        </div>
        <div class="bottom box">
            <div>
                <a href="index.html"><img src="./img/logo.gif" alt="" class="logo"></a>
                <a href="index.html" class="index"><img src="./img/home.png" class="home">首页</a>
            </div>
            <div >
                <input type="text" name="search" placeholder="剃须刀">
                <a href="#" class="cx">
                    <img src="./img/searchbg.png" alt="">
                </a>
                <a href="#" class="cart">
                    <span>购物车</span>
                </a>
            </div>
        </div>
    </header>
    <div class="main">
        <div class="reg">
			<ul>
				<li><h3>欢迎注册飞科商城</h3></li>                    
				<li>
					<span class="uname_pic"></span><input onfocus="n_msg()" onblur="reg_uname()" type="text" id="uname" placeholder="用户名" >
				</li>
				<li><span id="uname_msg"></span></li> 
				<li>
					<span class="upwd_pic"></span><input type="password" id="upwd" placeholder="密码" onfocus="p_msg()" onblur="reg_upwd()">
				</li>
				<li><span id="upwd_msg"></span></li>
				<li>
					<span class="upwd_pic"></span><input type="password" id="cupwd" placeholder="确认密码" onblur="reg_cupwd()" onfocus="cp_msg()">
				</li>
				<li><span id="cupwd_msg"></span></li>
				<li >
					<span class="phone_pic"></span><input type="text" id="phone" placeholder="手机号" onfocus="ph_msg()" onblur="reg_phone()">
				</li>
				<li><span id="phone_msg"></span></li>
				<li>
					<span class="email_pic"></span><input type="text" id="email" placeholder="邮箱" onfocus="e_msg()" onblur="reg_email()">
				</li>
				<li><span id="email_msg"></span></li>
				<li><a href="#">《飞科商城用户协议》</a></li>
				<li><button id="agree_reg" onclick="reg()">同意协议并注册</button></li>
			</ul>
        </div>
    </div>
    <script>
		//获取焦点，提示登录账号规则
		function n_msg(){
            uname_msg.innerHTML="用户名长度为4~16位";
        }
		//获取焦点，提登陆示密码规则
		function p_msg(){
            upwd_msg.innerHTML="密码长度为6~16位";
        }
		//获取焦点提示确认密码规则
        function cp_msg(){
            cupwd_msg.innerHTML="密码长度为6~16位";
        }
		//获取焦点提示输入合法邮箱
        function e_msg(){
            email_msg.innerHTML="请输入您的邮箱账号";
        }
		//获取焦点提示输入合法联系方式
		function ph_msg(){
            phone_msg.innerHTML="请输入您的手机号码";
        }
		//移除焦点，提示账号是否被占用，提示输入规则是否正确
		function reg_uname(){
            var str=uname.value;
            var reg=/^[0-9A-Za-z_]{4,16}$/;
            // 判断用户名是否符合规则
            if( reg.test(str)){
                //用户名符合规则，发送异步请求，验证用户名是否可用 
                var xhr=new XMLHttpRequest();//创建异步请求对象
                // 绑定响应状态码，接收响应
                xhr.onreadystatechange=function(){
                    if(xhr.readyState==4&&xhr.status==200){
                        var result=xhr.responseText;
                        if(result==0){
                            uname_msg.innerHTML="该用户名已被占用";
                            agree_reg.disabled=false;
                        }else{
                            uname_msg.innerHTML="用户名可用";
                        }
                    }
                }
                //打开连接，建立请求
                xhr.open("get","http://127.0.0.1:3000/user/reg_uname?uname="+uname.value,true);
                // 发送请求
                xhr.send(null);
            }else{
               uname_msg.innerHTML="用户名长度必须介于4~16位之间";
            }
        }
        //移除焦点，确认账号密码是否符合规则
        function reg_upwd(){
            var str=upwd.value;
            var reg=/^[0-9a-zA-Z_]{6,16}$/
            if(reg.test(str)){
                upwd_msg.innerHTML="密码可用";
            }else{
                upwd_msg.innerHTML="密码长度需介于6~16位";
                agree_reg.disabled=false;
            }
        }
		//移除焦点，提示确认密码与账号密码是否一致
		function reg_cupwd(){
            if(upwd.value==cupwd.value){
                cupwd_msg.innerHTML="密码输入正确";
            }else{
                cupwd_msg.innerHTML="两次密码输入不一样";
                cupwd.value="";
                agree_reg.disabled=false;
            }
        }
		//移除焦点，检测邮箱是否合法
		function reg_email(){
            var str=email.value;
            var reg=/^[0-9A-Za-z][\.-_0-9A-Za-z]*@[0-9A-Za-z]+(?:\.[0-9A-Za-z]+)+$/;
            if(reg.test(str)){
                email_msg.innerHTML="邮箱账号合法";
            }else{
                email_msg.innerHTML="邮箱账号不合法";
                agree_reg.disabled=false;
            }
        }
		//移除焦点，检测手机号是否合法
		function reg_phone(){
            var str=phone.value;
            var reg=/^1[3-9][0-9]{9}$/;
            if(reg.test(str)){
                phone_msg.innerHTML="手机号输入正确";
            }else{
                phone_msg.innerHTML="手机号不可用，请重新输入";
                agree_reg.disabled=false;
            }
        }
		//注册
        function reg(){
            var xhr=new XMLHttpRequest();
            xhr.onreadystatechange=function(){
                if(xhr.readyState==4&&xhr.status==200){
                    var result=xhr.responseText;
                    if(result==0){
                        alert("注册失败")
                    }else if(result==1){
                        alert("注册成功")
                    }
                }
            }
            // 打开连接，建立请求
            xhr.open("post","http://127.0.0.1:3000/user/reg",true);
            var formdata=`uname=${uname.value}&upwd=${upwd.value}&email=${email.value}&phone=${phone.value}`
            // 设置头信息
            xhr.setRequestHeader("content-type","application/x-www-form-urlencoded");
            // 发送请求
            xhr.send(formdata);
        }     
    
	</script>	
    <footer class="m_over">
        <ul class="footer_top box">
            <li> <img src="./img/ensure.png" alt=""><span>领导品牌 品质保证</span></li>
            <li> <img src="./img/return.png" alt=""><span>7天退货 15天换货</span></li>
            <li> <img src="./img/free.png" alt=""><span>全场免运费（部分配件除外）</span></li>
            <li> <img src="./img/unprofor.png" alt=""><span>全国网点 联保服务</span></li>
        </ul>
        <ul class="footer_middle box">
            <li>
                <h3>购物服务</h3>
                <p><a href="#">购物指南</a></p>
                <p><a href="#">配送方式</a></p>
                <p><a href="#">支付方式</a></p>
            </li> 
            <li>
                <h3>服务支持</h3>
                <p><a href="#">售后网点</a></p>
                <p><a href="#">积分规则</a></p>
                <p><a href="#">保修政策</a></p>
            </li>
            <li>
                <h3>关注我们</h3>
                <p><a href="#">新浪微博</a></p>
                <p><a href="#">关注微信</a></p>
                <p><a href="#">APP下载</a></p>
            </li>
            <li>
                <h3>关于飞科</h3>
                <p><a href="#">飞科介绍</a></p>
                <p><a href="#">飞科新闻</a></p>
                <p><a href="#">联系我们</a></p>
            </li> 
              
            <li>
                <img src="./img/qr_code.jpg" alt="">
                <p>关注飞科电器官方微信</p>
            </li>  
            <li>
                <img src="./img/service1.png" alt="">
            </li>  
        </ul>
        <div class="box footer_bottom">   
            <img src="./img/minilogo.jpg" alt="">
            <div>
                <p>Copyright © 2013-2016上海飞科电器股份有限公司 | 版权所有 | 网站备案/许可证号：沪ICP备13041208号</p>
                <a href="#">
                        增值电信营业经营许可认证:沪B2-20160083</a>
                <span>|</span>
                <a href=""><img src="./img/fkab.png" alt="">沪公网安备 31010502001341号</a>
            </div>
            <div>
                <a href="#"><img src="./img/rightimg1.jpg" alt=""></a>
                <a href="#"><img src="./img/rightimg2.jpg" alt=""></a>
                <a href="#"><img src="./img/rightimg3.jpg" alt=""></a>
                <a href="#"><img src="./img/rightimg4.jpg" alt=""></a>
            </div>
        </div>
    </footer>
</body>
</html>